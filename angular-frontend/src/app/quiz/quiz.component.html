<!DOCTYPE html>
<html lang="en">

<head>
  <title>Default</title>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap Stylesheet -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous"></script>


  <!-- Bootstrap Icon -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <link rel="stylesheet" type="text/css" href="./quiz.component.scss">
</head>

<body>

<mat-toolbar class="custom-toolbar">
  <div class="toolbar-left">
    <img ngSrc="assets/Logo.png" alt="Logo" class="toolbar-logo" height="365" width="928"/>
  </div>

  <div class="toolbar-right">
    <nav>
      <ul class="nav-links">
        <li><a routerLink="/home">Home</a></li>
        <li><a routerLink="/topics">Topics</a></li>
        <li><a routerLink="/progress">Progress</a></li>
        <button mat-stroked-button class="logout-btn" routerLink="/login">Log Out</button>
      </ul>
    </nav>
  </div>
</mat-toolbar>

<div class="back-button-section">
  <a class="back-button" [routerLink]="['/topic', this.topicId]">&#x3c; Back</a>
</div>

<div class="quiz-container">
  <div *ngIf="!showResults">
    <div class="question-section">
      <h2 class="question-text">{{ currentQuestion?.questionText }}</h2>

      <div class="answer-section">
        <!-- Multiple Choice -->
        <ng-container *ngIf="currentQuestion?.questionType === 'MULTIPLE_CHOICE'">
          <div
            *ngFor="let option of currentQuestion?.options"
            class="option"
            [class.selected]="selectedOption === option"
            (click)="selectOption(option)">
            <input type="radio" name="options" [value]="option" [(ngModel)]="selectedOption"/>
            <label>{{ option }}</label>
          </div>
        </ng-container>

        <!-- True/False -->
        <ng-container *ngIf="currentQuestion?.questionType === 'TRUE_FALSE'">
          <div *ngFor="let option of  currentQuestion?.options" class="option"
               [class.selected]="selectedOption === option"
               (click)="selectOption(option)">
            <label>
              <input type="radio" name="truefalse" [value]="option" [(ngModel)]="selectedOption"/>
              {{ option }}
            </label>
          </div>
        </ng-container>

        <!-- Short Answer -->
        <ng-container *ngIf="currentQuestion?.questionType === 'SHORT_ANSWER'">
       <textarea
         [(ngModel)]="shortAnswer"
         (input)="updateShortAnswer($event)"
         class="short-answer"
         placeholder="Type your answer here..."
       ></textarea>
        </ng-container>
      </div>
    </div>

    <div class="navigation">
      <button (click)="goBack()" [disabled]="currentStep === 0">Back</button>
      <button (click)="goNext()">{{ currentStep === questions.length - 1 ? 'Finish' : 'Next' }}</button>
    </div>
  </div>

  <!-- Quiz Results Section -->
  <div *ngIf="showResults" class="results-container">
    <h2>Quiz Results</h2>
    <p>You scored <strong>{{ score }}</strong> out of <strong>{{ questions.length }}</strong></p>

    <div class="results-summary">
      <div *ngFor="let question of questions" class="result-question">
        <h3>{{ question.questionText }}</h3>

        <div class="options-container">
          <div *ngFor="let option of question.options" class="option"
               [ngClass]="{
                'correct-answer': option === question.correctAnswer,
                'incorrect-answer': option === question.userAnswer && option !== question.correctAnswer
             }">
            <input type="radio" [checked]="question.userAnswer === option" disabled/>
            <label>{{ option }}</label>
          </div>
          <div *ngIf="question.questionType === 'SHORT_ANSWER'" class="option">
            <span><strong>Your Answer:</strong> {{ question.userAnswer }}</span>
          </div>
        </div>

        <div class="feedback">
          <span *ngIf="question.userAnswer === question.correctAnswer" class="correct">✔ Correct!</span>
          <span *ngIf="question.userAnswer !== question.correctAnswer" class="incorrect">
          ✘ Incorrect. <br><strong>Correct Answer:</strong> {{ question.correctAnswer }}
        </span>
        </div>
      </div>
    </div>
    <div class="result-buttons">
    <button (click)="restartQuiz()">Restart Quiz</button>
    <button (click)="leaveQuiz()">Back to Topic</button>
    </div>
  </div>

</div>

<footer class="footer">
  © 2024 Copyright OOP Vision. All Rights Reserved
</footer>
</body>
</html>
